#!/usr/bin/env python3
import numpy
import unittest

import find_duplicates
import visual_diff


class TestGetLengths(unittest.TestCase):
    def setUp(self):
        contents = 'print(hello(1, 2)) and print(hello("hi", 2))'
        data = visual_diff.get_tokens(contents, "python")
        self.matrix = visual_diff.make_matrix(data.tokens, data.tokens)

    def test_compare_to_self(self):
        expected = numpy.array([
            #p  (  h  (  1  ,  2  )  )  a  p  (  h  (  "  ,  2  )  )
            [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0, 0, 0, 0, 0, 0],  # print
            [0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 6, 0, 1, 0, 0, 0, 0, 0],  # (
            [0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0, 0, 0, 0],  # hello
            [0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 6, 0, 0, 0, 0, 0],  # (
            [0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0],  # 1
            [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0],  # ,
            [0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0],  # 2
            [0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 6, 1],  # )
            [0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 6],  # )
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0],  # and
            [6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0],  # print
            [0, 6, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0],  # (
            [0, 0, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0],  # hello
            [0, 1, 0, 6, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0],  # (
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0],  # "hi"
            [0, 0, 0, 0, 0, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0],  # ,
            [0, 0, 0, 0, 1, 0, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0],  # 2
            [0, 0, 0, 0, 0, 0, 0, 6, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1],  # )
            [0, 0, 0, 0, 0, 0, 0, 1, 6, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1],  # )
            ])
        actual = find_duplicates.get_lengths(self.matrix, True)
        #print("expected:")
        #print(expected)
        #print("actual:")
        #print(actual)
        #print("diff:")
        #print(expected - actual)
        self.assertTrue((expected == actual).all())

    def test_compare_to_other(self):
        expected = numpy.array([
            # p  (  h  (  1  ,  2  )  )  a  p  (  h  (  "  ,  2  )  ) 
            [19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0, 0, 0, 0, 0, 0],  # print
            [ 0,19, 0,14, 0, 0, 0, 0, 0, 0, 0, 6, 0, 1, 0, 0, 0, 0, 0],  # (
            [ 0, 0,19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0, 0, 0, 0],  # hello
            [ 0,14, 0,19, 0, 0, 0, 0, 0, 0, 0, 1, 0, 6, 0, 0, 0, 0, 0],  # (
            [ 0, 0, 0, 0,19, 0,11, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0],  # 1
            [ 0, 0, 0, 0, 0,19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0],  # ,
            [ 0, 0, 0, 0,11, 0,19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0],  # 2
            [ 0, 0, 0, 0, 0, 0, 0,19,10, 0, 0, 0, 0, 0, 0, 0, 0, 6, 1],  # )
            [ 0, 0, 0, 0, 0, 0, 0,10,19, 0, 0, 0, 0, 0, 0, 0, 0, 1, 6],  # )
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0,19, 0, 0, 0, 0, 0, 0, 0, 0, 0],  # and
            [ 6, 0, 0, 0, 0, 0, 0, 0, 0, 0,19, 0, 0, 0, 0, 0, 0, 0, 0],  # print
            [ 0, 6, 0, 1, 0, 0, 0, 0, 0, 0, 0,19, 0, 4, 0, 0, 0, 0, 0],  # (
            [ 0, 0, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0,19, 0, 0, 0, 0, 0, 0],  # hello
            [ 0, 1, 0, 6, 0, 0, 0, 0, 0, 0, 0, 4, 0,19, 0, 0, 0, 0, 0],  # (
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,19, 0, 0, 0, 0],  # "hi"
            [ 0, 0, 0, 0, 0, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0,19, 0, 0, 0],  # ,
            [ 0, 0, 0, 0, 1, 0, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0,19, 0, 0],  # 2
            [ 0, 0, 0, 0, 0, 0, 0, 6, 1, 0, 0, 0, 0, 0, 0, 0, 0,19, 1],  # )
            [ 0, 0, 0, 0, 0, 0, 0, 1, 6, 0, 0, 0, 0, 0, 0, 0, 0, 1,19]   # )
            ])

        actual = find_duplicates.get_lengths(self.matrix, False)
        #print("expected:")
        #print(expected)
        #print("actual:")
        #print(actual)
        #print("diff:")
        #print(expected - actual)
        self.assertTrue((expected == actual).all())


if __name__ == '__main__':
    unittest.main()
